<!DOCTYPE html>
<html>

<head>
  <!--Google charts library-->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>


  <!--Jquery library-->
  <script src="libraries/jquery-3.4.1.min.js"></script>

  <!--Test Libraries-->
  <script src="https://unpkg.com/chai/chai.js"></script>
  <script src="https://unpkg.com/mocha/mocha.js"></script>
  <!--My functions library-->
  <script type="text/javascript" src="/libraries/script.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/mocha/mocha.css" />

  <!--Bootstrap CSS CDN-->
  <link rel="stylesheet" href="libraries/bootstrap.min.css">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>


  <!--My stylesheet-->
  <link rel="stylesheet" href="/libraries/style.css">

  <!--Custom font-->
  <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed&display=swap" rel="stylesheet">

  <!--Favicon Resources-->
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">

  <!--Make website responsive-->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script>
    var amount1 = 1;
    var amount2 = 1;
    //Makes an ajax call and populates the pie chart
    $.get("/getPieDataAsync", function (data) {
      try {
        var piedata = data;
        //   $('#line1Target').text(bottle[0].target);
        //$('#line2Target').text(bottle[1].target);
        amount1 = piedata[0].amount;
        amount2 = piedata[1].amount;
      } catch (Exception) {
        console.log(Exception)
      }
    });
    var result;

    //Address of websocket server
    //const url = 'ws://localhost:8080'
    //const connection = new WebSocket(url)

    //checkIfLoggedIn();

    jQuery(document).ready(function () {
      loadNavbar();


      var params = {
        target: 123
      };
      var method = "POST";

      ///$('#btnSubmit').click(function () {
      //  $.ajax({
      //   type: method,
      //   url: "/targets2",
      //   data: params
      //  }).done(function (e) {
      //     console.log(e);
      //  })
      // })
    });

    // Load the Visualization API and the corechart package.
    google.charts.load('current', { 'packages': ['corechart'] });

    // Set a callback to run when the Google Visualization API is loaded.




    google.charts.load('current', { packages: ['corechart', 'line'] });
    google.charts.setOnLoadCallback(drawBasic);

    // Callback that creates and populates a data table,
    // instantiates the pie chart, passes in the data and
    // draws it.
    function drawChart() {
      try {
        var bracket = amount1;
        var sidewall = amount2;
      } catch{
        console.log("error")
      }

      // Create the data table.
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Topping');
      data.addColumn('number', 'Slices');
      console.log(bracket);
      data.addRows([
        ['Bracket #423', parseInt(bracket)],
        ['Sidewall #323', parseInt(sidewall)]
      ]);
      // Set chart options
      var options = {
        'title': 'Assembled part #32',
        'width': '100%',
        'height': 500
      };

      // Instantiate and draw our chart, passing in some options.
      var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
      chart.draw(data, options);
    }
    google.charts.setOnLoadCallback(drawChart);

  </script>
</head>

<body>
  <h1 style="float:left" class="ml-3" id="h1Index">
    <img class="mb-2" src="/icons/baseline_work_black_18dp.png" width="30" height="30" alt="">
    Management View</h1>
  <a style="position: relative; float: right; text-align: right; margin-top: 10px; z-index: 1000;" class="nav-link"
    href="#" onclick="logout()">Logout</a>

  <div style="clear:both;"></div>
  <div id="navDiv"></div>

  <h2 class="ml-4">Analytics</h2>
  <table class="table-responsive container-fluid  pl-0 pr-0 ml-0" style="margin-left: -50px !important;">
  <tr>
    <td>
      <!--Div that will hold the pie chart-->
      <div id="chart_div" style="max-width: 600px; width: 400px"></div>
    </td>
    <td>
      <!--Div that will hold the line chart-->
      <div id="line_chart_div" style="max-height: 400px; max-width: 800px; width: 400px"></div>
    </td>
  </tr>
  </table>




  <h1 class="ml-3" style="display:inline-block;">Targets:</h1><button class="btn btn-primary mb-3 mt-2 ml-2" value="Refresh"
    id="btnRefresh" onclick="document.location.reload()">Refresh</button>
  <h2 class="ml-3">Line 1: <small id="line1Target"></small></h2>
  <h2 class="ml-3">Line 2: <small id="line2Target"></small></h2>
  </div>
  <div id="mocha" class="ml-0 pl-0"></div>


  <script>



  </script>
  <script>
    jQuery(document).ready(function () {

      $.ajax({
        type: 'GET',
        url: '/getTargetsAsync',
        dataType: 'text',
        success: testFunc,
        error: function (req, err) {
          console.log('my message' + err);
        },
      });

      function testFunc(input) {
        data = JSON.parse(input);
        $('#line1Target').text(data[0].target);
        $('#line2Target').text(data[1].target);
      }
    });

  </script>
  <script class="mocha-init">
    mocha.setup('tdd');
    //mocha.checkLeaks();
  </script>
  <script src="/libraries/tests.js"></script>
  <script class="mocha-exec">

    mocha.run();
  </script>

</body>

</html>